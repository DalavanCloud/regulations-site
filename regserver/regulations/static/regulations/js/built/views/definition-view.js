define("definition-view",["jquery","underscore","backbone","sidebar-module-view","reg-model","dispatch","regs-helpers","./regs-router"],function(e,t,n,r,i,s,o,u){var a=r.extend({className:"open-definition",events:{"click .close-button.tab-activated":"close","click .close-button":"headerButtonClose"},initialize:function(){var e;this.render=t.bind(this.render,this),this.id=this.options.id,s.hasPushState()&&(this.events["click .definition"]="sendDefinitionLinkEvent",this.events["click .continue-link"]="sendContinueLinkEvent",this.delegateEvents(this.events)),e=i.get(this.id,this.render)},formatInterpretations:function(){var t=this.$el.find(".inline-interpretation"),n,r,i,u;typeof t[0]!="undefined"&&(n=e(t[0]).data("interp-id"),r=o.findBaseSection(n),t.remove(),u=s.getURLPrefix(),i="/"+r+"/"+s.getVersion()+"#"+n,u&&(i="/"+u+i),this.$el.children(".definition-text").append(o.fastLink(i,"Official Interpretation","continue-link internal interp",["data-linked-section",r])))},removeHeadings:function(){var t=this.$el.find("dfn.key-term"),n;if(typeof t[0]!="undefined"){n=t.length;for(var r=0;r<n;r++)e(t[r]).remove()}},definitionRouter:function(e,n,r){var i=s.getURLPrefix(),o=t.compact(e.split("/"));s.trigger("ga-event:definition",{action:r,context:"#"+n}),i&&o[0]===i&&(e=o.slice(1).join("/")),u.navigate(e,{trigger:!0})},sendContinueLinkEvent:function(t){t.preventDefault();var n=e(t.target),r=n.attr("href"),i=n.data("linked-section");this.definitionRouter(r,i,"clicked continue link")},sendDefinitionLinkEvent:function(t){t.preventDefault();var n=e(t.target),r=n.attr("href"),i=o.findBaseSection(n.data("definition"));this.definitionRouter(r,i,"clicked term inside definition")},render:function(e){var t,n,r,i;return this.$el.html('<div class="definition-text">'+e+"</div>"),t=this.$el.find(".definition-text"),n=o.findBaseSection(this.id),this.$el.prepend('<div class="sidebar-header group"><h4>Defined Term<a class="right close-button" href="#">Close definition</a></h4></div>'),i=s.getURLPrefix(),r="/"+n+"/"+s.getVersion()+"#"+this.id,i&&(r="/"+i+r),t.append(o.fastLink(r,o.idToRef(this.id),"continue-link internal",["data-linked-section",n])),this.formatInterpretations(),this.removeHeadings(),this.$el.attr("tabindex","0"),t.append('<a class="close-button tab-activated" href="#">Close definition</a>'),s.trigger("definition:render",this.$el),this.$el.focus(),this},close:function(e){e.preventDefault(),s.remove("definition"),s.trigger("ga-event:definition",{action:"closed definition by tab-revealed link",context:this.id}),s.trigger("definition:remove",this.id)},headerButtonClose:function(e){e.preventDefault(),s.remove("definition"),s.trigger("ga-event:definition","close by header button"),s.trigger("definition:remove",this.id)},remove:function(){return this.stopListening(),this.$el.remove(),s.trigger("sidebarModule:remove",this.id),e(".definition.active").focus(),this}});return a});